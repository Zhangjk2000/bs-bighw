{"remainingRequest":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\BS\\annotate-system-3\\frontend\\src\\views\\entityAnnotate\\components\\annotateContent\\AnnotateContent.vue?vue&type=style&index=0&id=77b76808&scoped=true&lang=scss&","dependencies":[{"path":"F:\\BS\\annotate-system-3\\frontend\\src\\views\\entityAnnotate\\components\\annotateContent\\AnnotateContent.vue","mtime":1639627257292},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1639628020883},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1639628025719},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1639628021884},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1639628023152},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1639628022585},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1639628023030}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi8qIOWboOS4uuaYr+acieWbuuWumuWumuS9je+8jOaJgOS7peimgeaciW1hcmdpbi10b3AgKi8NCiNwYXBlciB7DQogIG1hcmdpbi10b3A6IDQ4LjhweDsNCg0KICAvKiDmoIfms6jml7blr7nor53moYbnmoTmoLflvI8gKi8NCiAgLm9wdGlvbkRpYWxvZyB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDE0NywgMTIxLCAxMjEpOw0KICAgIHBhZGRpbmc6IDVweDsNCiAgICB6LWluZGV4OiAxMDsgLyog6K6+572u5aCG5Y+g5qyh5bqP77yM6Ziy5q2i6KKr6KaG55uWICovDQoNCiAgICBidXR0b24gew0KICAgICAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7DQogICAgICBtYXJnaW4tbGVmdDogMTBweDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBvdXRsaW5lOiBub25lOw0KICAgICAgYm94LXNoYWRvdzogMCA4cHggMTZweCAwIHJnYmEoMCwgMCwgMCwgMC4yKSwNCiAgICAgICAgMCA2cHggMjBweCAwIHJnYmEoMCwgMCwgMCwgMC4xOSk7DQogICAgfQ0KICB9DQoNCiAgLmhlYWQgew0KICAgIGZvbnQtc2l6ZTogMTVweDsNCiAgICBjb2xvcjogd2hpdGU7DQogIH0NCg0KICAudGlwIHsNCiAgICBmb250LXNpemU6IDEwcHg7DQogICAgY29sb3I6IHdoaXRlOw0KICB9DQoNCiAgLyog6Z2i5p2/5qGG5qC35byPICovDQogIC5wYW5lbCA+IC5wYW5lbC1oZWFkaW5nIHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICM3YjhjYTM7DQogICAgY29sb3I6IHdoaXRlOw0KICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQogIH0NCg0KICAvKiDkvqfovrnmoI/moLflvI8gKi8NCiAgLnNpZGUgew0KICAgIGJ1dHRvbiB7DQogICAgICBib3JkZXI6IDFweCBzb2xpZCBibGFjazsNCiAgICAgIG1hcmdpbi10b3A6IDEwcHg7DQogICAgICBtYXJnaW4tbGVmdDogMTBweDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBvdXRsaW5lOiBub25lOw0KICAgICAgYm94LXNoYWRvdzogMCA4cHggMTZweCAwIHJnYmEoMCwgMCwgMCwgMC4yKSwNCiAgICAgICAgMCA2cHggMjBweCAwIHJnYmEoMCwgMCwgMCwgMC4xOSk7DQogICAgfQ0KICB9DQoNCiAgLyog5paH5pys5qC35byPICovDQogIC5hbm5vdGF0ZS1jb250ZW50IHsNCiAgICBtYXJnaW4tdG9wOiA1MHB4Ow0KICAgIG92ZXJmbG93OiBhdXRvOw0KICAgIGZsZXg6IGF1dG87DQogICAgbWluLWhlaWdodDogMTAwMHB4Ow0KICAgIHBhZGRpbmc6IDAgNSUgMCA1JTsNCiAgICB3aGl0ZS1zcGFjZTogcHJlLWxpbmU7DQogICAgd29yZC1icmVhazogYnJlYWstYWxsOw0KICAgIGxpbmUtaGVpZ2h0OiAyNXB4Ow0KICAgIGZvbnQtZmFtaWx5OiBNaWNyb3NvZnQgWWFoZWksIHNlcmlmOw0KICB9DQogIC8vIOe/u+ivkeWNoeeJhw0KICAudHJhbnNsYXRlLWNhcmQgew0KICAgIHdpZHRoOiAyMDBweDsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgei1pbmRleDogMTsNCg0KICAgIC5kZWxldGUtYnV0dG9uIHsNCiAgICAgIHRvcDogMTBweDsNCiAgICAgIHJpZ2h0OiAtNDBweDsNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["AnnotateContent.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmSA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"AnnotateContent.vue","sourceRoot":"src/views/entityAnnotate/components/annotateContent","sourcesContent":["<template>\r\n  <div id=\"paper\">\r\n    <!-- TODO 有空把这里的bootstrap换成原生css -->\r\n    <link\r\n      rel=\"stylesheet\"\r\n      href=\"https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css\"\r\n      integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\"\r\n      crossorigin=\"anonymous\"\r\n    />\r\n    <!-- 选择实体标注还是关系标注 -->\r\n    <div\r\n      v-show=\"showFunctionDialog\"\r\n      ref=\"showFunctionDialog\"\r\n      class=\"optionDialog\"\r\n    >\r\n      <button @click=\"chooseEntityAnnotate\">\r\n        实体标注\r\n      </button>\r\n      <button @click=\"chooseRelationAnnotate\">\r\n        关系标注\r\n      </button>\r\n      <button @click=\"chooseAttributeAnnotate\">\r\n        属性标注\r\n      </button>\r\n    </div>\r\n\r\n    <!-- 标注选项对话框 -->\r\n    <div v-show=\"showDialog\" ref=\"showDialog\" class=\"optionDialog\">\r\n      <button\r\n        v-for=\"(info, index) in labels\"\r\n        :key=\"index\"\r\n        :style=\"{ backgroundColor: info.color }\"\r\n        @click=\"annotateText(index + '-' + $store.state.annotate.id, index)\"\r\n      >\r\n        {{ info.text }}({{ info.shortcut }})\r\n      </button>\r\n      <!-- 翻译按钮 -->\r\n      <button @click=\"translateText\">\r\n        翻译\r\n      </button>\r\n    </div>\r\n\r\n    <!-- 翻译结果显示 -->\r\n    <div v-show=\"showTranslateCard\" ref=\"translateCard\" class=\"translate-card\">\r\n      <i\r\n        class=\"el-message__closeBtn el-icon-close delete-button\"\r\n        @click=\"showTranslateCard = false\"\r\n      />\r\n      <TranslateCard :data=\"translateResult\" />\r\n    </div>\r\n\r\n    <!-- 定义一个容器 -->\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <!-- 侧边栏 -->\r\n        <div class=\"col-md-2\">\r\n          <div class=\"panel panel-default\">\r\n            <div class=\"panel-heading\">\r\n              <div class=\"head\">\r\n                现有标签\r\n              </div>\r\n              <hr />\r\n              <div class=\"tip\">\r\n                (选中文本后单击任一标签即可标注)\r\n              </div>\r\n            </div>\r\n            <div class=\"panel-body\">\r\n              <div class=\"side\">\r\n                <button\r\n                  v-for=\"(info, index) in labels\"\r\n                  :key=\"index\"\r\n                  :style=\"{ backgroundColor: info.color }\"\r\n                  @click=\"\r\n                    annotateText(index + '-' + $store.state.annotate.id, index)\r\n                  \"\r\n                >\r\n                  {{ info.text }}({{ info.shortcut }})\r\n                </button>\r\n                <br /><br />\r\n                <router-link to=\"/labelsManage\">\r\n                  添加新标签\r\n                </router-link>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 论文排版 -->\r\n        <div class=\"col-md-10\">\r\n          <div class=\"panel panel-default\">\r\n            <div class=\"panel-heading\">\r\n              <div class=\"head\">\r\n                文章如下\r\n              </div>\r\n            </div>\r\n            <div id=\"panel-body\" class=\"panel-body\">\r\n              <pre\r\n                id=\"annotateContent\"\r\n                class=\"annotate-content\"\r\n                :style=\"'font-size:' + $store.state.annotate.fontSize + 'px'\"\r\n                @mouseup=\"getSelection($event)\"\r\n                v-text=\"$store.state.annotate.annotateText\"\r\n              ></pre>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport TranslateCard from \"./components/TranslateCard\";\r\n\r\nimport {\r\n  entityAnnotateUtil,\r\n  relationAnnotateUtil,\r\n  relationMatchingUtil,\r\n} from \"@/utils/annotateUtils\";\r\nimport { translateApi } from \"@/api/annotateData\";\r\n\r\nimport { mapGetters } from \"vuex\";\r\n\r\nexport default {\r\n  name: \"Essays\",\r\n  components: {\r\n    TranslateCard,\r\n  },\r\n  data() {\r\n    return {\r\n      showFunctionDialog: false,\r\n      showDialog: false, //显示标注对话框\r\n      selectText: \"\", // 选中文本\r\n      showTranslateCard: false, //显示翻译卡片\r\n      translateResult: {}, //翻译结果\r\n      flag: false, // 标记上一次选择的是实体标注还是关系标注\r\n      position1: [[], []], // 关系标注的第一段文本位置\r\n      position2: [[], []], // 关系标注的第二段文本位置\r\n      id: [0, 0], // 选中文本的id值\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"labels\"]), // 标签\r\n  },\r\n  // 键盘标注，初始化即开始监听\r\n  created() {\r\n    this.annotateByShortcut();\r\n  },\r\n  methods: {\r\n    /**\r\n     *  在鼠标位置弹出对话框\r\n     * @param {number} X  x轴坐标\r\n     * @param {number} Y  y轴坐标\r\n     */\r\n    setBoxPosition(X, Y) {\r\n      this.$refs.showDialog.style.left = `${X - 100}px`;\r\n      this.$refs.showDialog.style.top = `${Y + 20}px`;\r\n      this.$refs.showFunctionDialog.style.left = `${X - 100}px`;\r\n      this.$refs.showFunctionDialog.style.top = `${Y + 20}px`;\r\n      this.$refs.translateCard.style.left = `${X + 10}px`;\r\n      this.$refs.translateCard.style.top = `${Y + 10}px`;\r\n    },\r\n\r\n    /**\r\n     *  获取选中文本，鼠标位置加上滚动距离\r\n     * @param e  浏览器事件\r\n     */\r\n\r\n    getSelection(e) {\r\n      if (window.getSelection().toString() !== \"\") {\r\n        if (!this.flag) {\r\n          this.selectText = window.getSelection().toString();\r\n          this.setBoxPosition(e.pageX, e.pageY);\r\n\r\n          //this.$refs.showDialog.style.display = \"block\";\r\n          //this.showDialog = true\r\n          this.showDialog = false;\r\n          this.showFunctionDialog = true;\r\n          // this.position1[0] = e.pageX;\r\n          // this.position1[1] = e.pageY;\r\n        } else {\r\n          // 若上次选择的是关系标注，则直接标注并传回两次标注文本的位置\r\n          this.position2[0] = window\r\n            .getSelection()\r\n            .getRangeAt(0)\r\n            .getClientRects()[\"0\"].x;\r\n          this.position2[1] = window\r\n            .getSelection()\r\n            .getRangeAt(0)\r\n            .getClientRects()[\"0\"].y;\r\n          // this.position2[0] = e.pageX;\r\n          // this.position2[1] = e.pageY;\r\n          relationAnnotateUtil(this.id, 1);\r\n          this.id[1]++;\r\n          relationMatchingUtil(this.position1, this.position2, this.id);\r\n          this.flag = false;\r\n        }\r\n      }\r\n      //点击空白处取消标注\r\n      else {\r\n        this.showDialog = false;\r\n        // 得加下面这句才能让标注对话框消失，不清楚为什么\r\n        this.$refs.showDialog.style.display = \"none\";\r\n\r\n        this.showFunctionDialog = false;\r\n      }\r\n    },\r\n\r\n    /**\r\n     *  选择实体标注\r\n     */\r\n    chooseEntityAnnotate() {\r\n      this.showFunctionDialog = false;\r\n      this.$refs.showDialog.style.display = \"block\";\r\n      this.showDialog = true;\r\n    },\r\n\r\n    /**\r\n     *  选择关系标注\r\n     */\r\n    chooseRelationAnnotate() {\r\n      this.showFunctionDialog = false;\r\n      this.position1[0] = window.getSelection().getRangeAt(0).getClientRects()[\r\n        \"0\"\r\n      ].x;\r\n      this.position1[1] = window.getSelection().getRangeAt(0).getClientRects()[\r\n        \"0\"\r\n      ].y;\r\n      //console.log(window.getSelection().getRangeAt(0).getClientRects());\r\n      relationAnnotateUtil(this.id, 0);\r\n      this.id[0]++;\r\n\r\n      // 下一次选中别的文本时直接标注，不用跳出功能选择框\r\n      this.flag = true;\r\n      console.log(this.flag);\r\n    },\r\n\r\n    /**\r\n     *  选择属性标注\r\n     */\r\n    chooseAttributeAnnotate() {\r\n      // TODO\r\n    },\r\n\r\n    /**\r\n     *  标注文本\r\n     * @param {string} id  给button标签的id，用于删除时查找\r\n     * @param {number} index 标注颜色索引\r\n     */\r\n    annotateText(id, index) {\r\n      // 隐藏对话框\r\n      this.showDialog = false;\r\n      //console.log(this.showDialog);\r\n      entityAnnotateUtil(id, index);\r\n    },\r\n\r\n    /**\r\n     *  快捷键标注\r\n     */\r\n    annotateByShortcut() {\r\n      document.onkeydown = ($event) => {\r\n        let key = $event.key;\r\n        let id = this.$store.state.annotate.id;\r\n        this.showDialog = false;\r\n        let j = 0;\r\n        for (; j < this.labels.length; j++) {\r\n          if (key === this.labels[j].shortcut) {\r\n            entityAnnotateUtil(j + \"-\" + id, j);\r\n            break;\r\n          }\r\n        }\r\n      };\r\n    },\r\n\r\n    /**\r\n     *  翻译\r\n     */\r\n    translateText() {\r\n      this.showDialog = false;\r\n      let text = window.getSelection().toString();\r\n      // 调用翻译api\r\n      translateApi(text).then((res) => {\r\n        this.translateResult = res.data;\r\n        this.showTranslateCard = true;\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n/* 因为是有固定定位，所以要有margin-top */\r\n#paper {\r\n  margin-top: 48.8px;\r\n\r\n  /* 标注时对话框的样式 */\r\n  .optionDialog {\r\n    position: absolute;\r\n    border-radius: 10px;\r\n    background-color: rgb(147, 121, 121);\r\n    padding: 5px;\r\n    z-index: 10; /* 设置堆叠次序，防止被覆盖 */\r\n\r\n    button {\r\n      border: 1px solid black;\r\n      margin-left: 10px;\r\n      border-radius: 10px;\r\n      cursor: pointer;\r\n      outline: none;\r\n      box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2),\r\n        0 6px 20px 0 rgba(0, 0, 0, 0.19);\r\n    }\r\n  }\r\n\r\n  .head {\r\n    font-size: 15px;\r\n    color: white;\r\n  }\r\n\r\n  .tip {\r\n    font-size: 10px;\r\n    color: white;\r\n  }\r\n\r\n  /* 面板框样式 */\r\n  .panel > .panel-heading {\r\n    background-image: none;\r\n    background-color: #7b8ca3;\r\n    color: white;\r\n    font-weight: 400;\r\n  }\r\n\r\n  /* 侧边栏样式 */\r\n  .side {\r\n    button {\r\n      border: 1px solid black;\r\n      margin-top: 10px;\r\n      margin-left: 10px;\r\n      border-radius: 10px;\r\n      cursor: pointer;\r\n      outline: none;\r\n      box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2),\r\n        0 6px 20px 0 rgba(0, 0, 0, 0.19);\r\n    }\r\n  }\r\n\r\n  /* 文本样式 */\r\n  .annotate-content {\r\n    margin-top: 50px;\r\n    overflow: auto;\r\n    flex: auto;\r\n    min-height: 1000px;\r\n    padding: 0 5% 0 5%;\r\n    white-space: pre-line;\r\n    word-break: break-all;\r\n    line-height: 25px;\r\n    font-family: Microsoft Yahei, serif;\r\n  }\r\n  // 翻译卡片\r\n  .translate-card {\r\n    width: 200px;\r\n    position: absolute;\r\n    z-index: 1;\r\n\r\n    .delete-button {\r\n      top: 10px;\r\n      right: -40px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}