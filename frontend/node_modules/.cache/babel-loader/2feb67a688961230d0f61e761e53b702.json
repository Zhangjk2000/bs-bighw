{"remainingRequest":"F:\\BS\\annotate-system\\frontend\\node_modules\\babel-loader\\lib\\index.js!F:\\BS\\annotate-system\\frontend\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\BS\\annotate-system\\frontend\\src\\utils\\permission.js","dependencies":[{"path":"F:\\BS\\annotate-system\\frontend\\src\\utils\\permission.js","mtime":1639627257282},{"path":"F:\\BS\\annotate-system\\frontend\\babel.config.js","mtime":1639627257111},{"path":"F:\\BS\\annotate-system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1639628022585},{"path":"F:\\BS\\annotate-system\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1639628024341},{"path":"F:\\BS\\annotate-system\\frontend\\node_modules\\eslint-loader\\index.js","mtime":1639628021347}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkY6XFxCU1xcYW5ub3RhdGUtc3lzdGVtXFxmcm9udGVuZFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWVcXGhlbHBlcnNcXGVzbVxcYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICJAL3V0aWxzL2F1dGgiOyAvLyDku45jb29raWXojrflj5bku6TniYwKCmltcG9ydCBnZXRQYWdlVGl0bGUgZnJvbSAiQC91dGlscy9nZXQtcGFnZS10aXRsZSI7CmltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tICJlbGVtZW50LXVpIjsKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICJucHJvZ3Jlc3MiOyAvLyDov5vluqbmnaEKCmltcG9ydCAibnByb2dyZXNzL25wcm9ncmVzcy5jc3MiOyAvLyDov5vluqbmoI/moLflvI8KCmltcG9ydCByb3V0ZXIgZnJvbSAiLi4vcm91dGVyIjsKaW1wb3J0IHN0b3JlIGZyb20gIi4uL3N0b3JlIjsKTlByb2dyZXNzLmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOyAvLyBOUHJvZ3Jlc3PphY3nva4KCnZhciBmaXJzdFJlcXVlc3QgPSB0cnVlOyAvLyDlvIDlj5HpmLbmrrXkvb/nlKjvvIzpppbmrKHmiZPlvIDliY3nq6/pobXpnaLnmoTmoIforrAKCnZhciB3aGl0ZUxpc3QgPSBbIi9sb2dpbiIsICJlbnRpdHlBbm5vdGF0ZSIsICIvcmVnaXN0ZXIiLCAiL3Rlc3QiXTsgLy8g5rKh5pyJ6YeN5a6a5ZCR55m95ZCN5Y2VCgpyb3V0ZXIuYmVmb3JlRWFjaCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh0bywgZnJvbSwgbmV4dCkgewogICAgdmFyIGhhc1Rva2VuLCBoYXNHZXRVc2VySW5mbzsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgLy8g5byA5aeL6L+b5bqm5p2hCiAgICAgICAgICAgIE5Qcm9ncmVzcy5zdGFydCgpOyAvLyDorr7nva7pobXpnaLmoIfpopgKCiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gZ2V0UGFnZVRpdGxlKHRvLm1ldGEudGl0bGUpOyAvLyDnoa7lrprnlKjmiLfmmK/lkKblt7LnmbvlvZUKCiAgICAgICAgICAgIGhhc1Rva2VuID0gZ2V0VG9rZW4oKTsKCiAgICAgICAgICAgIGlmICghaGFzVG9rZW4pIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghKHRvLnBhdGggPT09ICIvbG9naW4iKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpoLmnpzlt7LnmbvlvZXvvIzor7fph43lrprlkJHliLDkuLvpobUKICAgICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgICAgcGF0aDogIi8iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBOUHJvZ3Jlc3MuZG9uZSgpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjc7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgaGFzR2V0VXNlckluZm8gPSBzdG9yZS5nZXR0ZXJzLmF2YXRhcjsKCiAgICAgICAgICAgIGlmICghaGFzR2V0VXNlckluZm8pIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI3OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTQ7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCJ1c2VyL2dldEluZm8iKTsKCiAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDIwOwogICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDE0KTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goImFwaS9yZXNldFRva2VuIik7CgogICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgTWVzc2FnZS5lcnJvcihfY29udGV4dC50MCB8fCAiSGFzIEVycm9yIik7CiAgICAgICAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CgogICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMwOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAvKiDmsqHmnInku6TniYwqLwogICAgICAgICAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgLy8g5Zyo5YWN6LS555m75b2V55m95ZCN5Y2V5Lit77yM55u05o6l6L+b5YWlCiAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIOWFtuS7luaXoOadg+iuv+mXrueahOmhtemdouWwhuiiq+mHjeWumuWQkeWIsOeZu+W9lemhtemdouOAggogICAgICAgICAgICAgIG5leHQoIi9sb2dpbiIpOwoKICAgICAgICAgICAgICBpZiAoIWZpcnN0UmVxdWVzdCkgewogICAgICAgICAgICAgICAgTWVzc2FnZS5lcnJvcigi6K+35YWI55m75b2V77yBIik7CiAgICAgICAgICAgICAgICBmaXJzdFJlcXVlc3QgPSBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMTQsIDIwXV0pOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeCwgX3gyLCBfeDMpIHsKICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpKTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAoKSB7CiAgLy8g5a6M5oiQ6L+b5bqm5qCPCiAgTlByb2dyZXNzLmRvbmUoKTsKfSk7"},{"version":3,"sources":["F:/BS/annotate-system/frontend/src/utils/permission.js"],"names":["getToken","getPageTitle","Message","NProgress","router","store","configure","showSpinner","firstRequest","whiteList","beforeEach","to","from","next","start","document","title","meta","hasToken","path","done","hasGetUserInfo","getters","avatar","dispatch","error","indexOf","afterEach"],"mappings":";;AAAA,SAASA,QAAT,QAAyB,cAAzB,C,CAAyC;;AACzC,OAAOC,YAAP,MAAyB,wBAAzB;AACA,SAASC,OAAT,QAAwB,YAAxB;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAmC;;AACnC,OAAO,yBAAP,C,CAAkC;;AAClC,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AAEAF,SAAS,CAACG,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB,E,CAA6C;;AAC7C,IAAIC,YAAY,GAAG,IAAnB,C,CAAyB;;AACzB,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAW,gBAAX,EAA6B,WAA7B,EAA0C,OAA1C,CAAlB,C,CAAsE;;AAEtEL,MAAM,CAACM,UAAP;AAAA,qEAAkB,iBAAOC,EAAP,EAAWC,IAAX,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAChB;AACAV,YAAAA,SAAS,CAACW,KAAV,GAFgB,CAIhB;;AACAC,YAAAA,QAAQ,CAACC,KAAT,GAAiBf,YAAY,CAACU,EAAE,CAACM,IAAH,CAAQD,KAAT,CAA7B,CALgB,CAOhB;;AACME,YAAAA,QARU,GAQClB,QAAQ,EART;;AAAA,iBAUZkB,QAVY;AAAA;AAAA;AAAA;;AAAA,kBAWVP,EAAE,CAACQ,IAAH,KAAY,QAXF;AAAA;AAAA;AAAA;;AAYZ;AACAN,YAAAA,IAAI,CAAC;AAAEM,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AACAhB,YAAAA,SAAS,CAACiB,IAAV;AAdY;AAAA;;AAAA;AAgBNC,YAAAA,cAhBM,GAgBWhB,KAAK,CAACiB,OAAN,CAAcC,MAhBzB;;AAAA,iBAiBRF,cAjBQ;AAAA;AAAA;AAAA;;AAkBVR,YAAAA,IAAI;AAlBM;AAAA;;AAAA;AAAA;AAAA;AAAA,mBAsBFR,KAAK,CAACmB,QAAN,CAAe,cAAf,CAtBE;;AAAA;AAuBRX,YAAAA,IAAI;AAvBI;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mBA0BFR,KAAK,CAACmB,QAAN,CAAe,gBAAf,CA1BE;;AAAA;AA2BRtB,YAAAA,OAAO,CAACuB,KAAR,CAAc,eAAS,WAAvB;AACAZ,YAAAA,IAAI,2BAAoBF,EAAE,CAACQ,IAAvB,EAAJ;AACAhB,YAAAA,SAAS,CAACiB,IAAV;;AA7BQ;AAAA;AAAA;;AAAA;AAkCd;AAEA,gBAAIX,SAAS,CAACiB,OAAV,CAAkBf,EAAE,CAACQ,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrC;AACAN,cAAAA,IAAI;AACL,aAHD,MAGO;AACL;AACAA,cAAAA,IAAI,UAAJ;;AACA,kBAAI,CAACL,YAAL,EAAmB;AACjBN,gBAAAA,OAAO,CAACuB,KAAR,CAAc,OAAd;AACAjB,gBAAAA,YAAY,GAAG,KAAf;AACD;;AACDL,cAAAA,SAAS,CAACiB,IAAV;AACD;;AA/Ca;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAlB;;AAAA;AAAA;AAAA;AAAA;AAmDAhB,MAAM,CAACuB,SAAP,CAAiB,YAAM;AACrB;AACAxB,EAAAA,SAAS,CAACiB,IAAV;AACD,CAHD","sourcesContent":["import { getToken } from \"@/utils/auth\"; // 从cookie获取令牌\r\nimport getPageTitle from \"@/utils/get-page-title\";\r\nimport { Message } from \"element-ui\";\r\nimport NProgress from \"nprogress\"; // 进度条\r\nimport \"nprogress/nprogress.css\"; // 进度栏样式\r\nimport router from \"../router\";\r\nimport store from \"../store\";\r\n\r\nNProgress.configure({ showSpinner: false }); // NProgress配置\r\nlet firstRequest = true; // 开发阶段使用，首次打开前端页面的标记\r\nconst whiteList = [\"/login\", \"entityAnnotate\", \"/register\", \"/test\"]; // 没有重定向白名单\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n  // 开始进度条\r\n  NProgress.start();\r\n\r\n  // 设置页面标题\r\n  document.title = getPageTitle(to.meta.title);\r\n\r\n  // 确定用户是否已登录\r\n  const hasToken = getToken();\r\n\r\n  if (hasToken) {\r\n    if (to.path === \"/login\") {\r\n      // 如果已登录，请重定向到主页\r\n      next({ path: \"/\" });\r\n      NProgress.done();\r\n    } else {\r\n      const hasGetUserInfo = store.getters.avatar;\r\n      if (hasGetUserInfo) {\r\n        next();\r\n      } else {\r\n        try {\r\n          // 获取用户信息\r\n          await store.dispatch(\"user/getInfo\");\r\n          next();\r\n        } catch (error) {\r\n          // 删除令牌并进入登录页面重新登录\r\n          await store.dispatch(\"api/resetToken\");\r\n          Message.error(error || \"Has Error\");\r\n          next(`/login?redirect=${to.path}`);\r\n          NProgress.done();\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    /* 没有令牌*/\r\n\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      // 在免费登录白名单中，直接进入\r\n      next();\r\n    } else {\r\n      // 其他无权访问的页面将被重定向到登录页面。\r\n      next(`/login`);\r\n      if (!firstRequest) {\r\n        Message.error(\"请先登录！\");\r\n        firstRequest = false;\r\n      }\r\n      NProgress.done();\r\n    }\r\n  }\r\n});\r\n\r\nrouter.afterEach(() => {\r\n  // 完成进度栏\r\n  NProgress.done();\r\n});\r\n"]}]}