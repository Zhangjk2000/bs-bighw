{"remainingRequest":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\babel-loader\\lib\\index.js!F:\\BS\\annotate-system-3\\frontend\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\BS\\annotate-system-3\\frontend\\src\\utils\\permission.js","dependencies":[{"path":"F:\\BS\\annotate-system-3\\frontend\\src\\utils\\permission.js","mtime":1639627257282},{"path":"F:\\BS\\annotate-system-3\\frontend\\babel.config.js","mtime":1639627257111},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1639628022585},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1639628024341},{"path":"F:\\BS\\annotate-system-3\\frontend\\node_modules\\eslint-loader\\index.js","mtime":1639628021347}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkY6XFxCU1xcYW5ub3RhdGUtc3lzdGVtLTNcXGZyb250ZW5kXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZVxcaGVscGVyc1xcZXNtXFxhc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gIkAvdXRpbHMvYXV0aCI7IC8vIOS7jmNvb2tpZeiOt+WPluS7pOeJjAoKaW1wb3J0IGdldFBhZ2VUaXRsZSBmcm9tICJAL3V0aWxzL2dldC1wYWdlLXRpdGxlIjsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gImVsZW1lbnQtdWkiOwppbXBvcnQgTlByb2dyZXNzIGZyb20gIm5wcm9ncmVzcyI7IC8vIOi/m+W6puadoQoKaW1wb3J0ICJucHJvZ3Jlc3MvbnByb2dyZXNzLmNzcyI7IC8vIOi/m+W6puagj+agt+W8jwoKaW1wb3J0IHJvdXRlciBmcm9tICIuLi9yb3V0ZXIiOwppbXBvcnQgc3RvcmUgZnJvbSAiLi4vc3RvcmUiOwpOUHJvZ3Jlc3MuY29uZmlndXJlKHsKICBzaG93U3Bpbm5lcjogZmFsc2UKfSk7IC8vIE5Qcm9ncmVzc+mFjee9rgoKdmFyIGZpcnN0UmVxdWVzdCA9IHRydWU7IC8vIOW8gOWPkemYtuauteS9v+eUqO+8jOmmluasoeaJk+W8gOWJjeerr+mhtemdoueahOagh+iusAoKdmFyIHdoaXRlTGlzdCA9IFsiL2xvZ2luIiwgImVudGl0eUFubm90YXRlIiwgIi9yZWdpc3RlciIsICIvdGVzdCJdOyAvLyDmsqHmnInph43lrprlkJHnmb3lkI3ljZUKCnJvdXRlci5iZWZvcmVFYWNoKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB2YXIgaGFzVG9rZW4sIGhhc0dldFVzZXJJbmZvOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAvLyDlvIDlp4vov5vluqbmnaEKICAgICAgICAgICAgTlByb2dyZXNzLnN0YXJ0KCk7IC8vIOiuvue9rumhtemdouagh+mimAoKICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBnZXRQYWdlVGl0bGUodG8ubWV0YS50aXRsZSk7IC8vIOehruWumueUqOaIt+aYr+WQpuW3sueZu+W9lQoKICAgICAgICAgICAgaGFzVG9rZW4gPSBnZXRUb2tlbigpOwoKICAgICAgICAgICAgaWYgKCFoYXNUb2tlbikgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEodG8ucGF0aCA9PT0gIi9sb2dpbiIpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOWmguaenOW3sueZu+W9le+8jOivt+mHjeWumuWQkeWIsOS4u+mhtQogICAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgICBwYXRoOiAiLyIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICBoYXNHZXRVc2VySW5mbyA9IHN0b3JlLmdldHRlcnMuYXZhdGFyOwoKICAgICAgICAgICAgaWYgKCFoYXNHZXRVc2VySW5mbykgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjc7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxNDsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE3OwogICAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goInVzZXIvZ2V0SW5mbyIpOwoKICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI3OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjA7CiAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMTQpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjQ7CiAgICAgICAgICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaCgiYXBpL3Jlc2V0VG9rZW4iKTsKCiAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICBNZXNzYWdlLmVycm9yKF9jb250ZXh0LnQwIHx8ICJIYXMgRXJyb3IiKTsKICAgICAgICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLnBhdGgpKTsKICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKCiAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgIC8qIOayoeacieS7pOeJjCovCiAgICAgICAgICAgIGlmICh3aGl0ZUxpc3QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAvLyDlnKjlhY3otLnnmbvlvZXnmb3lkI3ljZXkuK3vvIznm7TmjqXov5vlhaUKICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8g5YW25LuW5peg5p2D6K6/6Zeu55qE6aG16Z2i5bCG6KKr6YeN5a6a5ZCR5Yiw55m75b2V6aG16Z2i44CCCiAgICAgICAgICAgICAgbmV4dCgiL2xvZ2luIik7CgogICAgICAgICAgICAgIGlmICghZmlyc3RSZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICBNZXNzYWdlLmVycm9yKCLor7flhYjnmbvlvZXvvIEiKTsKICAgICAgICAgICAgICAgIGZpcnN0UmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSwgbnVsbCwgW1sxNCwgMjBdXSk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gKF94LCBfeDIsIF94MykgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpOwpyb3V0ZXIuYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHsKICAvLyDlrozmiJDov5vluqbmoI8KICBOUHJvZ3Jlc3MuZG9uZSgpOwp9KTs="},{"version":3,"sources":["F:/BS/annotate-system-3/frontend/src/utils/permission.js"],"names":["getToken","getPageTitle","Message","NProgress","router","store","configure","showSpinner","firstRequest","whiteList","beforeEach","to","from","next","start","document","title","meta","hasToken","path","done","hasGetUserInfo","getters","avatar","dispatch","error","indexOf","afterEach"],"mappings":";;AAAA,SAASA,QAAT,QAAyB,cAAzB,C,CAAyC;;AACzC,OAAOC,YAAP,MAAyB,wBAAzB;AACA,SAASC,OAAT,QAAwB,YAAxB;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAmC;;AACnC,OAAO,yBAAP,C,CAAkC;;AAClC,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AAEAF,SAAS,CAACG,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB,E,CAA6C;;AAC7C,IAAIC,YAAY,GAAG,IAAnB,C,CAAyB;;AACzB,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAW,gBAAX,EAA6B,WAA7B,EAA0C,OAA1C,CAAlB,C,CAAsE;;AAEtEL,MAAM,CAACM,UAAP;AAAA,qEAAkB,iBAAOC,EAAP,EAAWC,IAAX,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAChB;AACAV,YAAAA,SAAS,CAACW,KAAV,GAFgB,CAIhB;;AACAC,YAAAA,QAAQ,CAACC,KAAT,GAAiBf,YAAY,CAACU,EAAE,CAACM,IAAH,CAAQD,KAAT,CAA7B,CALgB,CAOhB;;AACME,YAAAA,QARU,GAQClB,QAAQ,EART;;AAAA,iBAUZkB,QAVY;AAAA;AAAA;AAAA;;AAAA,kBAWVP,EAAE,CAACQ,IAAH,KAAY,QAXF;AAAA;AAAA;AAAA;;AAYZ;AACAN,YAAAA,IAAI,CAAC;AAAEM,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;AACAhB,YAAAA,SAAS,CAACiB,IAAV;AAdY;AAAA;;AAAA;AAgBNC,YAAAA,cAhBM,GAgBWhB,KAAK,CAACiB,OAAN,CAAcC,MAhBzB;;AAAA,iBAiBRF,cAjBQ;AAAA;AAAA;AAAA;;AAkBVR,YAAAA,IAAI;AAlBM;AAAA;;AAAA;AAAA;AAAA;AAAA,mBAsBFR,KAAK,CAACmB,QAAN,CAAe,cAAf,CAtBE;;AAAA;AAuBRX,YAAAA,IAAI;AAvBI;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mBA0BFR,KAAK,CAACmB,QAAN,CAAe,gBAAf,CA1BE;;AAAA;AA2BRtB,YAAAA,OAAO,CAACuB,KAAR,CAAc,eAAS,WAAvB;AACAZ,YAAAA,IAAI,2BAAoBF,EAAE,CAACQ,IAAvB,EAAJ;AACAhB,YAAAA,SAAS,CAACiB,IAAV;;AA7BQ;AAAA;AAAA;;AAAA;AAkCd;AAEA,gBAAIX,SAAS,CAACiB,OAAV,CAAkBf,EAAE,CAACQ,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrC;AACAN,cAAAA,IAAI;AACL,aAHD,MAGO;AACL;AACAA,cAAAA,IAAI,UAAJ;;AACA,kBAAI,CAACL,YAAL,EAAmB;AACjBN,gBAAAA,OAAO,CAACuB,KAAR,CAAc,OAAd;AACAjB,gBAAAA,YAAY,GAAG,KAAf;AACD;;AACDL,cAAAA,SAAS,CAACiB,IAAV;AACD;;AA/Ca;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAlB;;AAAA;AAAA;AAAA;AAAA;AAmDAhB,MAAM,CAACuB,SAAP,CAAiB,YAAM;AACrB;AACAxB,EAAAA,SAAS,CAACiB,IAAV;AACD,CAHD","sourcesContent":["import { getToken } from \"@/utils/auth\"; // 从cookie获取令牌\r\nimport getPageTitle from \"@/utils/get-page-title\";\r\nimport { Message } from \"element-ui\";\r\nimport NProgress from \"nprogress\"; // 进度条\r\nimport \"nprogress/nprogress.css\"; // 进度栏样式\r\nimport router from \"../router\";\r\nimport store from \"../store\";\r\n\r\nNProgress.configure({ showSpinner: false }); // NProgress配置\r\nlet firstRequest = true; // 开发阶段使用，首次打开前端页面的标记\r\nconst whiteList = [\"/login\", \"entityAnnotate\", \"/register\", \"/test\"]; // 没有重定向白名单\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n  // 开始进度条\r\n  NProgress.start();\r\n\r\n  // 设置页面标题\r\n  document.title = getPageTitle(to.meta.title);\r\n\r\n  // 确定用户是否已登录\r\n  const hasToken = getToken();\r\n\r\n  if (hasToken) {\r\n    if (to.path === \"/login\") {\r\n      // 如果已登录，请重定向到主页\r\n      next({ path: \"/\" });\r\n      NProgress.done();\r\n    } else {\r\n      const hasGetUserInfo = store.getters.avatar;\r\n      if (hasGetUserInfo) {\r\n        next();\r\n      } else {\r\n        try {\r\n          // 获取用户信息\r\n          await store.dispatch(\"user/getInfo\");\r\n          next();\r\n        } catch (error) {\r\n          // 删除令牌并进入登录页面重新登录\r\n          await store.dispatch(\"api/resetToken\");\r\n          Message.error(error || \"Has Error\");\r\n          next(`/login?redirect=${to.path}`);\r\n          NProgress.done();\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    /* 没有令牌*/\r\n\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      // 在免费登录白名单中，直接进入\r\n      next();\r\n    } else {\r\n      // 其他无权访问的页面将被重定向到登录页面。\r\n      next(`/login`);\r\n      if (!firstRequest) {\r\n        Message.error(\"请先登录！\");\r\n        firstRequest = false;\r\n      }\r\n      NProgress.done();\r\n    }\r\n  }\r\n});\r\n\r\nrouter.afterEach(() => {\r\n  // 完成进度栏\r\n  NProgress.done();\r\n});\r\n"]}]}