{"remainingRequest":"F:\\BS\\annotate-system\\frontend\\node_modules\\babel-loader\\lib\\index.js!F:\\BS\\annotate-system\\frontend\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\BS\\annotate-system\\frontend\\src\\utils\\request.js","dependencies":[{"path":"F:\\BS\\annotate-system\\frontend\\src\\utils\\request.js","mtime":1639627257283},{"path":"F:\\BS\\annotate-system\\frontend\\babel.config.js","mtime":1639627257111},{"path":"F:\\BS\\annotate-system\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1639628022585},{"path":"F:\\BS\\annotate-system\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1639628024341},{"path":"F:\\BS\\annotate-system\\frontend\\node_modules\\eslint-loader\\index.js","mtime":1639628021347}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCBzdG9yZSBmcm9tICJAL3N0b3JlIjsKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICJAL3V0aWxzL2F1dGgiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgeyBNZXNzYWdlLCBNZXNzYWdlQm94IH0gZnJvbSAiZWxlbWVudC11aSI7IC8vIOWIm+W7uuS4gOS4qmF4aW9z5a6e5L6LCgp2YXIgc2VydmljZSA9IGF4aW9zLmNyZWF0ZSh7CiAgYmFzZVVSTDogImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMCIsCiAgdGltZW91dDogNTAwMAp9KTsKc2VydmljZS5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoZnVuY3Rpb24gKGNvbmZpZykgewogIGlmIChzdG9yZS5nZXR0ZXJzLnRva2VuKSB7CiAgICBjb25maWcuaGVhZGVyc1siYW5ub3RhdGUtc3lzdGVtLXRva2VuIl0gPSBnZXRUb2tlbigpOwogIH0KCiAgcmV0dXJuIGNvbmZpZzsKfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgLy8g5YGa5LiA5Lqb6K+35rGC6ZSZ6K+vCiAgY29uc29sZS5sb2coZXJyb3IpOyAvLyDnlKjkuo7osIPor5UKCiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKfSk7CnNlcnZpY2UuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZSgKLyoqDQogKiDpgJrov4foh6rlrprkuYnku6PnoIHnoa7lrpror7fmsYLnirbmgIENCiAqLwpmdW5jdGlvbiAocmVzcG9uc2UpIHsKICB2YXIgcmVzID0gcmVzcG9uc2UuZGF0YTsgLy8g5aaC5p6c6Ieq5a6a5LmJ5Luj56CB5LiN5pivMjAwMDDvvIzliJnlsIblhbbliKTmlq3kuLrplJnor6/jgIIKCiAgaWYgKHJlcy5jb2RlICE9PSAyMDAwMCkgewogICAgTWVzc2FnZSh7CiAgICAgIG1lc3NhZ2U6IHJlcy5tZXNzYWdlIHx8ICJFcnJvciIsCiAgICAgIHNob3dDbG9zZTogdHJ1ZSwKICAgICAgdHlwZTogImVycm9yIiwKICAgICAgZHVyYXRpb246IDUgKiAxMDAwCiAgICB9KTsgLy8gNTAwMDg6IOmdnuazleS7pOeJjO+8myA1MDAxMu+8muWFtuS7luWuouaIt+err+eZu+W9le+8myA1MDAxNO+8muS7pOeJjOW3sui/h+acn++8mwoKICAgIGlmIChyZXMuY29kZSA9PT0gNTAwMDggfHwgcmVzLmNvZGUgPT09IDUwMDEyIHx8IHJlcy5jb2RlID09PSA1MDAxNCkgewogICAgICAvLyDph43mlrDnmbvlvZUKICAgICAgTWVzc2FnZUJveC5jb25maXJtKCLmgqjlt7Lnu4/ms6jplIDnmbvlvZXnirbmgIHkuobvvIzmgqjlj6/ku6XpgInmi6nlj5bmtojku6XnlZnlnKjmnKzpobXpnaLvvIzmiJbogIXpgInmi6nph43mlrDnmbvlvZUiLCAi5rOo6ZSA55m75b2V54q25oCB6YCa55+lIiwgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi6YeN5paw55m75b2VIiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAi5Y+W5raIIiwKICAgICAgICB0eXBlOiAid2FybmluZyIKICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgc3RvcmUuZGlzcGF0Y2goImFwaS9yZXNldFRva2VuIikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihyZXMubWVzc2FnZSB8fCAiRXJyb3IiKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXM7CiAgfQp9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICBjb25zb2xlLmxvZygiZXJyIiArIGVycm9yKTsgLy8g55So5LqO6LCD6K+VCgogIE1lc3NhZ2UoewogICAgbWVzc2FnZTogIue9kee7nOivt+axguWPkeeUn+mUmeivr++8jOivt+ajgOafpeaCqOeahOe9kee7nOeKtuaAgeaIluiBlOezu+euoeeQhuWRmCIsCiAgICBzaG93Q2xvc2U6IHRydWUsCiAgICB0eXBlOiAiZXJyb3IiLAogICAgZHVyYXRpb246IDUgKiAxMDAwCiAgfSk7CiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKfSk7CmV4cG9ydCBkZWZhdWx0IHNlcnZpY2U7"},{"version":3,"sources":["F:/BS/annotate-system/frontend/src/utils/request.js"],"names":["store","getToken","axios","Message","MessageBox","service","create","baseURL","timeout","interceptors","request","use","config","getters","token","headers","error","console","log","Promise","reject","response","res","data","code","message","showClose","type","duration","confirm","confirmButtonText","cancelButtonText","then","dispatch","location","reload","Error"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,SAAlB;AACA,SAASC,QAAT,QAAyB,cAAzB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,EAAkBC,UAAlB,QAAoC,YAApC,C,CAEA;;AACA,IAAMC,OAAO,GAAGH,KAAK,CAACI,MAAN,CAAa;AAC3BC,EAAAA,OAAO,EAAE,uBADkB;AAE3BC,EAAAA,OAAO,EAAE;AAFkB,CAAb,CAAhB;AAKAH,OAAO,CAACI,YAAR,CAAqBC,OAArB,CAA6BC,GAA7B,CACE,UAACC,MAAD,EAAY;AACV,MAAIZ,KAAK,CAACa,OAAN,CAAcC,KAAlB,EAAyB;AACvBF,IAAAA,MAAM,CAACG,OAAP,CAAe,uBAAf,IAA0Cd,QAAQ,EAAlD;AACD;;AACD,SAAOW,MAAP;AACD,CANH,EAOE,UAACI,KAAD,EAAW;AACT;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ,EAFS,CAEW;;AACpB,SAAOG,OAAO,CAACC,MAAR,CAAeJ,KAAf,CAAP;AACD,CAXH;AAcAX,OAAO,CAACI,YAAR,CAAqBY,QAArB,CAA8BV,GAA9B;AACE;AACF;AACA;AACE,UAACU,QAAD,EAAc;AACZ,MAAMC,GAAG,GAAGD,QAAQ,CAACE,IAArB,CADY,CAGZ;;AACA,MAAID,GAAG,CAACE,IAAJ,KAAa,KAAjB,EAAwB;AACtBrB,IAAAA,OAAO,CAAC;AACNsB,MAAAA,OAAO,EAAEH,GAAG,CAACG,OAAJ,IAAe,OADlB;AAENC,MAAAA,SAAS,EAAE,IAFL;AAGNC,MAAAA,IAAI,EAAE,OAHA;AAINC,MAAAA,QAAQ,EAAE,IAAI;AAJR,KAAD,CAAP,CADsB,CAQtB;;AACA,QAAIN,GAAG,CAACE,IAAJ,KAAa,KAAb,IAAsBF,GAAG,CAACE,IAAJ,KAAa,KAAnC,IAA4CF,GAAG,CAACE,IAAJ,KAAa,KAA7D,EAAoE;AAClE;AACApB,MAAAA,UAAU,CAACyB,OAAX,CACE,mCADF,EAEE,UAFF,EAGE;AACEC,QAAAA,iBAAiB,EAAE,MADrB;AAEEC,QAAAA,gBAAgB,EAAE,IAFpB;AAGEJ,QAAAA,IAAI,EAAE;AAHR,OAHF,EAQEK,IARF,CAQO,YAAM;AACXhC,QAAAA,KAAK,CAACiC,QAAN,CAAe,gBAAf,EAAiCD,IAAjC,CAAsC,YAAM;AAC1CE,UAAAA,QAAQ,CAACC,MAAT;AACD,SAFD;AAGD,OAZD;AAaD;;AACD,WAAOhB,OAAO,CAACC,MAAR,CAAe,IAAIgB,KAAJ,CAAUd,GAAG,CAACG,OAAJ,IAAe,OAAzB,CAAf,CAAP;AACD,GA1BD,MA0BO;AACL,WAAOH,GAAP;AACD;AACF,CArCH,EAsCE,UAACN,KAAD,EAAW;AACTC,EAAAA,OAAO,CAACC,GAAR,CAAY,QAAQF,KAApB,EADS,CACmB;;AAC5Bb,EAAAA,OAAO,CAAC;AACNsB,IAAAA,OAAO,EAAE,0BADH;AAENC,IAAAA,SAAS,EAAE,IAFL;AAGNC,IAAAA,IAAI,EAAE,OAHA;AAINC,IAAAA,QAAQ,EAAE,IAAI;AAJR,GAAD,CAAP;AAMA,SAAOT,OAAO,CAACC,MAAR,CAAeJ,KAAf,CAAP;AACD,CA/CH;AAkDA,eAAeX,OAAf","sourcesContent":["import store from \"@/store\";\r\nimport { getToken } from \"@/utils/auth\";\r\nimport axios from \"axios\";\r\nimport { Message, MessageBox } from \"element-ui\";\r\n\r\n// 创建一个axios实例\r\nconst service = axios.create({\r\n  baseURL: \"http://localhost:8000\",\r\n  timeout: 5000,\r\n});\r\n\r\nservice.interceptors.request.use(\r\n  (config) => {\r\n    if (store.getters.token) {\r\n      config.headers[\"annotate-system-token\"] = getToken();\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    // 做一些请求错误\r\n    console.log(error); // 用于调试\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nservice.interceptors.response.use(\r\n  /**\r\n   * 通过自定义代码确定请求状态\r\n   */\r\n  (response) => {\r\n    const res = response.data;\r\n\r\n    // 如果自定义代码不是20000，则将其判断为错误。\r\n    if (res.code !== 20000) {\r\n      Message({\r\n        message: res.message || \"Error\",\r\n        showClose: true,\r\n        type: \"error\",\r\n        duration: 5 * 1000,\r\n      });\r\n\r\n      // 50008: 非法令牌； 50012：其他客户端登录； 50014：令牌已过期；\r\n      if (res.code === 50008 || res.code === 50012 || res.code === 50014) {\r\n        // 重新登录\r\n        MessageBox.confirm(\r\n          \"您已经注销登录状态了，您可以选择取消以留在本页面，或者选择重新登录\",\r\n          \"注销登录状态通知\",\r\n          {\r\n            confirmButtonText: \"重新登录\",\r\n            cancelButtonText: \"取消\",\r\n            type: \"warning\",\r\n          }\r\n        ).then(() => {\r\n          store.dispatch(\"api/resetToken\").then(() => {\r\n            location.reload();\r\n          });\r\n        });\r\n      }\r\n      return Promise.reject(new Error(res.message || \"Error\"));\r\n    } else {\r\n      return res;\r\n    }\r\n  },\r\n  (error) => {\r\n    console.log(\"err\" + error); // 用于调试\r\n    Message({\r\n      message: \"网络请求发生错误，请检查您的网络状态或联系管理员\",\r\n      showClose: true,\r\n      type: \"error\",\r\n      duration: 5 * 1000,\r\n    });\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default service;\r\n"]}]}